<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
        <title>Five Computers &middot; Articles by GordonMcGregor</title>
        <link rel="shortcut icon" href="http://fivecomputers.com/favicon.ico" />
        <link href="http://fivecomputers.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Five Computers Atom Feed" />
                
        <link rel="stylesheet" href="http://fivecomputers.com/theme/css/screen.css" type="text/css" />
        <link rel="stylesheet" href="http://fivecomputers.com/theme/css/pygments.css" type="text/css" />


    </head>
    <body>
        <div id="header">
            <ul id="nav">
                <li class="ephemeral selected"><a href="http://fivecomputers.com/author/gordonmcgregor.html">GordonMcGregor</a></li>
                <li><a href="http://fivecomputers.com">Home</a></li>
                <li><a href="http://fivecomputers.com/pages/about-gordon.html">About Gordon</a></li>
                <li><a href="http://fivecomputers.com/archives.html">Archives</a></li>
            </ul>
            <div class="header_box">
                <h1><a href="http://fivecomputers.com">Five Computers</a></h1>
            </div>
        </div>
        <div id="wrapper">
            <div id="content">
                <h4 class="date">Oct 11,  2008</h4>
                <div class="post">
                    <h2 class="title">
                        <a href="http://fivecomputers.com/a-command-line-for-the-gui.html" rel="bookmark" title="Permanent Link to &quot;a command line for the gui&quot;">a command line for the gui</a>
                    </h2>
                    
                    <p style="text-align: center;"><a href="http://www.flickr.com/photos/52043707@N00/1471486765/"><img src="http://farm2.static.flickr.com/1085/1471486765_ffb394dbfe.jpg" height="334" width="500" alt="open" /></a><br /></p>

<p>I've been experimenting with Mac OS X now for a few months. Trying to work out if it is a reasonable platform for <a href="http://www.verilab.com" title="Verilab, Inc.">Verilab</a> to use internally for our various computing needs. One thing that I've come to love and now struggle to live without is a small add-on called <a href="http://en.wikipedia.org/wiki/Qu%C4%B1c%C4%B8s%C4%B1%C9%A9%E2%85%B4%CE%B5%CA%80">Quicksilver</a>. Superficially it isn't very interesting. A <a href="http://docs.blacktree.com/quicksilver/what_is_quicksilver">fast application launcher</a> - where's the fun in that? But after you delve a bit deeper, it becomes something else. It is really a command line interface for OS X, on top of the GUI.</p>

<p>I hit a key and up it pops. Type a few characters and I can launch an application. I don't have to search through drop down menus or find icons on a desktop - much faster. I want to get a music player to jump to the next track - hot key and type '<em>next</em>'. Stop the music, type '<em>stop</em>'. The magic is that I don't have to switch away from what I'm currently doing, go to a different window or application and do anything. Want to email someone? Hot key, type a bit of their name and select their email address - again, without switching away from what you are working in. I can even open and edit text files without starting up a text editor - extend a todo list, add a calendar entry to my google calendar, all from the command line within the GUI. All without switching away from the current context. I can run unix terminal commands, search in documents, select groups of files and email them to someone, do quick calculations. It is amazingly more efficient than using a mouse and hunting for applications and buttons.</p>

<p>I've always been a bit of a command-line junkie, wanting to know the keyboard shortcuts for things in a GUI environment, liking having a command prompt, but Quicksilver is different. It's a visual blend of command-line and GUI. Taking the best bits of both and putting them right under my fingertips. Highly recommended. Shame there isn't anything nearly as good for Windows XP or linux that I've found. Look <a href="http://www.43folders.com/topics/quicksilver">here</a> for more ideas about what Quicksilver can do.</p>

<p><br /></p>

                    <div class="clear"></div>
                    <p>There are <a href="http://fivecomputers.com/a-command-line-for-the-gui.html#disqus_thread">comments</a>.</p>
                    <div class="info">
                        <a href="http://fivecomputers.com/a-command-line-for-the-gui.html">posted at 12:00 P</a>&nbsp;&middot;&nbsp;<a href="http://fivecomputers.com/category/10.html" rel="tag">10</a>                                                <div class="tags">
                            <a href="http://fivecomputers.com/tag/software.html">software</a>
                        </div>                        
                    </div>
                    <div class="clear"></div>
                </div>

                <h4 class="date">Aug 13,  2008</h4>
                <div class="post">
                    <h2 class="title">
                        <a href="http://fivecomputers.com/a-few-good-men.html" rel="bookmark" title="Permanent Link to &quot;a few good men&quot;">a few good men</a>
                    </h2>
                    
                    <p><a href="http://www.flickr.com/photos/52043707@N00/1511132571/"><img src="http://farm3.static.flickr.com/2161/1511132571_ebe7649da0.jpg" height="334" width="500" alt="jackson pollock" /></a><br /></p>

<p><a href="http://www.43folders.com/2008/08/13/estimating-time">Interesting pos</a>t over on 43Folders on planning and task estimation. I've certainly experienced theses problems in the past but hadn't heard them described as the <a href="http://en.wikipedia.org/wiki/Planning_fallacy">planning fallacy</a> or <a href="http://en.wikipedia.org/wiki/Optimism_bias">optimism bias</a>. The suggested ~44% buffer to add is quite depressing but probably close to true based on my experience. That means in a typical 5 day work week, you'll be lucky to do useful work for even 3 of them.</p>

<p>The flip side of planning is probably something we've all experienced too. You do your best to come up with a realistic schedule, then you are told that that is unacceptable and to reduce it to a wildly unreasonable, unrealistic estimate. Everyone knows it will be unachievable, but that's what you work towards. No wonder so many projects slip - they finish right around when they would have finished with realistic planning. Now that isn't to excuse projects on a terminal death march or those that have gone wildly out of control. But so often, I've been on projects where the end date was set before the planning was done.</p>

<p>In fact, I think in those cases, a realistic schedule might mean the project would never start, so everyone puts on their rose-coloured glasses and agrees to an insane schedule, that meets the deadline. Then the project starts to slip, often before anyone can even do any work it will be late. Over my career I've collected metrics on the various projects I've worked on, formally and informally. I've found quite a bit of resistance to using this real world project data for subsequent planning sessions. Mostly that's been the case when a certain schedule was required, with set number of people and the nasty reality of past experience was meaning the numbers wouldn't add up <em>correctly.</em> Those projects finished when we originally thought they would too.</p>

<p>So how do we move beyond this? Is it really that we are so bad at estimating how long things will take? Or that we can't accept the numbers that we come up with because of the time to market pressures and realities of the market place? Do the planners want to know the truth right at the start, or deal with the successive revelation of the nasty reality over time? Execution <a href="http://en.wikipedia.org/wiki/Slow_slicing">by one thousand slips</a> or just planning business as usual?</p>

                    <div class="clear"></div>
                    <p>There are <a href="http://fivecomputers.com/a-few-good-men.html#disqus_thread">comments</a>.</p>
                    <div class="info">
                        <a href="http://fivecomputers.com/a-few-good-men.html">posted at 12:00 P</a>&nbsp;&middot;&nbsp;<a href="http://fivecomputers.com/category/13.html" rel="tag">13</a>                                                <div class="tags">
                            <a href="http://fivecomputers.com/tag/verification.html">verification</a>
                        </div>                        
                    </div>
                    <div class="clear"></div>
                </div>

                <h4 class="date">May  8,  2009</h4>
                <div class="post">
                    <h2 class="title">
                        <a href="http://fivecomputers.com/a-real-working-time-machine.html" rel="bookmark" title="Permanent Link to &quot;a real, working time machine&quot;">a real, working time machine</a>
                    </h2>
                    
                    <p>Was working on some files on my mac last night, editing photographs from a recent trip. It was getting late and I accidentally deleted a directory of images. Now my images are always backed up anyway, on a separate attached storage device, so this wasn't too big of a mistake. There's another copy of the same images on some DVDs, too. But it still would have taken time to go and find them and recovery the images. I'd also have lost the various edits I'd done over the last few hours. Annoying, certainly, but not fatal. However, this is a mac, and I've been running time machine to do automatic backups, to a cheap, 1Tb USB drive I have attached to the machine. It took me about 30 seconds to unroll the damage using that, via the nifty graphical interface. I lost about 10 minutes of work in total. I was impressed by how well it works, much like the daily and hourly .snapshots you get with a much more expensive netapp filer. Seems to have been done right.</p>

<div class="posttagsblock"><a href="http://technorati.com/tag/geekery" rel="tag">geekery</a>, <a href="http://technorati.com/tag/OSX" rel="tag">OSX</a>, <a href="http://technorati.com/tag/photography" rel="tag">photography</a></div>

                    <div class="clear"></div>
                    <p>There are <a href="http://fivecomputers.com/a-real-working-time-machine.html#disqus_thread">comments</a>.</p>
                    <div class="info">
                        <a href="http://fivecomputers.com/a-real-working-time-machine.html">posted at 12:00 P</a>&nbsp;&middot;&nbsp;<a href="http://fivecomputers.com/category/05.html" rel="tag">05</a>                                                <div class="tags">
                            <a href="http://fivecomputers.com/tag/.html"></a>
                        </div>                        
                    </div>
                    <div class="clear"></div>
                </div>

                <h4 class="date">Dec 21,  2012</h4>
                <div class="post">
                    <h2 class="title">
                        <a href="http://fivecomputers.com/a-simple-turtle-graphics-domain-specific-language-dsl-parser.html" rel="bookmark" title="Permanent Link to &quot;A simple turtle graphics Domain Specific Language (DSL) parser&quot;">A simple turtle graphics Domain Specific Language (DSL) parser</a>
                    </h2>
                    
                    <p>I&#39;ve been working through some of the exercises in &#39;<a href="http://pragprog.com/the-pragmatic-programmer" target="_self">The Pragmatic Programmer</a>&#39; while using it to mentor a colleague. &#0160;In particular, I spent a bit of time working on the Domain Specific Language section and considering creating little DSLs to provide flexible control. I&#39;ve painfully implemented DSLs in SystemVerilog/ UVM sequences in the past and thought about how I typically do this: build a parser, create tokens, then dispatch various execution functions to implement the commands. &#0160;Often, the pain of building all these pieces in a language like C or SV is enough of a barrier that I wouldn&#39;t even start. &#0160;</p>

<p>The example in the book is a simple Logo/ Turtle control language. &#0160;Pen up, Pen down, draw, turn, etc. It tries to simplify things by using single letter command codes and only one optional argument.</p>

<p><span style="font-family: &#39;courier new&#39;, courier;">P 2</span>
</p>

<p><span style="font-family: &#39;courier new&#39;, courier;">D</span></p>

<p><span style="font-family: &#39;courier new&#39;, courier;">W 2</span></p>

<p><span style="font-family: &#39;courier new&#39;, courier;">N 1</span></p>

<p><span style="font-family: &#39;courier new&#39;, courier;">E 1&#0160;</span></p>

<p><span style="font-family: &#39;courier new&#39;, courier;">S 1</span></p>

<p><span style="font-family: &#39;courier new&#39;, courier;">U</span></p>

<p>I know Python has a <a href="http://docs.python.org/2/library/turtle.html" target="_self">Logo/ Turtle engine built in</a>&#0160;so I decided to try to write a command parser/ dispatcher that would work with that, and let me write commands in a text file and have them execute Python Turtle commands.</p>

<p>Here&#39;s an example script (you can see the results of this at the end of this post):</p>

<pre><span style="font-family: &#39;courier new&#39;, courier;">color &quot;green&quot;</span><br /><span style="font-family: &#39;courier new&#39;, courier;">up</span><br /><span style="font-family: &#39;courier new&#39;, courier;">goto 0 -50 # comments are allowed</span><br /><span style="font-family: &#39;courier new&#39;, courier;">down</span><br /><span style="font-family: &#39;courier new&#39;, courier;">circle 50</span><br /><span style="font-family: &#39;courier new&#39;, courier;">up</span><br /><span style="font-family: &#39;courier new&#39;, courier;">color &quot;red&quot;</span><br /><span style="font-family: &#39;courier new&#39;, courier;">write &quot;Done!&quot;</span><br /><span style="font-family: &#39;courier new&#39;, courier;">sleep 2</span><br /><span style="font-family: &#39;courier new&#39;, courier;">exit</span></pre>

<p>I thought initially about having to parse out all the commands and arguments, then writing a large switch/ case statement (<a href="http://bytebaker.com/2008/11/03/switch-case-statement-in-python/" target="_self">or the Python equivalent with a dictionary</a>). &#0160;After thinking about it a little longer I realised I didn&#39;t have to do that at all. &#0160;I could use the Introspection in Python to look up available methods and if they exist, call them. In fact, as not finding the method will just cause an exception, I can just try executing any command and if it fails, catch it and move on.</p>

<p>So after parsing the input text stream (throw away comments, break up tokens using whitespace) then I just try to execute the command in the global namespace. &#0160;I&#39;ve pulled all the turtle functions into that namespace, so any turtle function is a valid command in my little parser. &#0160;The <span style="font-family: &#39;courier new&#39;, courier;">globals()[command[0]]</span> in the code below looks up the function in the global namespace and then calls it, using the other parts of the command (<span style="font-family: &#39;courier new&#39;, courier;">command[1:]</span>), after they&#39;ve each been processed through the Python <span style="font-family: &#39;courier new&#39;, courier;">eval</span> function to convert them from strings to whatever format they happen to be (numbers or strings mainly). &#0160;The final trick in this is using the * operator to take take a list and pass it as one argument after another to the function:</p>

<pre>globals()[command[0]](*(map(eval, command[1:])))</pre>

<p>
<br />
And that&#39;s all that&#39;s needed to implement a full Logo language parser and execution engine. The command syntax is fault tolerant and reports errors, with line numbers. &#0160;New commands can be added easily, by defining new functions. &#0160;They&#39;ll be automatically supported as they are added to the namespace. </p>

<p>Being able to pull something like this together quickly means that writing little Domain Specific Languages is possible and quite a low bar. &#0160;Doing something similar in C is often more daunting and even worse in a language like SystemVerilog, with such a poor string and file handling library. &#0160;There&#39;s a real value in being able to program at such a high level, that can greatly enhance what&#39;s possible or likely to be attempted in a verification environment. You <em>could</em> do this in SystemVerilog, but how often would you even think to attempt it, without rejecting it as too much work?</p>

<p>&#0160;</p>

<div class="highlight" style="background: #f8f8f8;">
<pre style="line-height: 125%;"><span style="color: #408080; font-style: italic;"># pull all the turtle commands into the global namespace, so they are valid commands</span>
<span style="color: #008000; font-weight: bold;">from</span> <span style="color: #0000ff; font-weight: bold;">turtle</span> <span style="color: #008000; font-weight: bold;">import</span> <span style="color: #666666;">*</span>

<span style="color: #408080; font-style: italic;"># Use these 3 lines to make &#39;sleep&#39; and &#39;exit&#39; useable commands</span>
<span style="color: #008000; font-weight: bold;">from</span> <span style="color: #0000ff; font-weight: bold;">time</span> <span style="color: #008000; font-weight: bold;">import</span> sleep
<span style="color: #008000; font-weight: bold;">from</span> <span style="color: #0000ff; font-weight: bold;">sys</span> <span style="color: #008000; font-weight: bold;">import</span> <span style="color: #008000;">exit</span>, argv

<span style="color: #408080; font-style: italic;"># Given a handle to a series of strings of commands, do them</span>
<span style="color: #008000; font-weight: bold;">def</span> <span style="color: #0000ff;">parse_and_draw</span>(commands):
    <span style="color: #008000; font-weight: bold;">for</span> (line_number, line) <span style="color: #aa22ff; font-weight: bold;">in</span> <span style="color: #008000;">enumerate</span>(commands):
        line <span style="color: #666666;">=</span> line<span style="color: #666666;">.</span>split(<span style="color: #ba2121;">&#39;#&#39;</span>)[<span style="color: #666666;">0</span>]  <span style="color: #408080; font-style: italic;"># throw away comments</span>

        <span style="color: #008000; font-weight: bold;">if</span> line:  <span style="color: #408080; font-style: italic;"># if there is anything left after getting rid of comments</span>

            command <span style="color: #666666;">=</span> line<span style="color: #666666;">.</span>strip()<span style="color: #666666;">.</span>split(<span style="color: #ba2121;">&#39; &#39;</span>)  <span style="color: #408080; font-style: italic;"># parse using spaces to delimit tokens  </span>
                                               <span style="color: #408080; font-style: italic;"># a big limitation of this, we can&#39;t have strings with spaces</span>
                                               <span style="color: #408080; font-style: italic;"># e.g.,  &quot;hello world&quot; won&#39;t work as it&#39;ll get split up</span>
                                               <span style="color: #408080; font-style: italic;"># into [&#39;&quot;hello&#39;, &#39;world&quot;&#39;] neither of which bits are valid when eval&#39;ed</span>

            <span style="color: #008000; font-weight: bold;">if</span> command[<span style="color: #666666;">0</span>]:  <span style="color: #408080; font-style: italic;"># if we have any command left </span>
                            <span style="color: #408080; font-style: italic;"># (e.g., an indented comment would dissappear)</span>

                <span style="color: #008000; font-weight: bold;">try</span>:
                    <span style="color: #408080; font-style: italic;"># The meat of the dispatcher is the next line</span>
                    <span style="color: #408080; font-style: italic;"># using a try/ except means we can always try to run any command</span>
                    <span style="color: #408080; font-style: italic;"># and assume that it is valid and catch if it isn&#39;t.</span>
                    <span style="color: #408080; font-style: italic;"># globals() returns a dictionary of every function defined in the global namespace</span>
                    <span style="color: #408080; font-style: italic;"># including all the turtle commands because of the from turtle import *</span>
                    <span style="color: #408080; font-style: italic;"># command[0] is used as a key to look up the function name</span>
                    <span style="color: #408080; font-style: italic;"># we then pass all of the other tokens (command[1:]) through eval (using map)</span>
                    <span style="color: #408080; font-style: italic;"># and pass them as arguments to the function we looked up</span>

                    <span style="color: #008000;">globals</span>()[command[<span style="color: #666666;">0</span>]](<span style="color: #666666;">*</span>(<span style="color: #008000;">map</span>(<span style="color: #008000;">eval</span>, command[<span style="color: #666666;">1</span>:])))

                    <span style="color: #408080; font-style: italic;"># a key error occurs if we don&#39;t find command[0] in the global namespace</span>
                <span style="color: #008000; font-weight: bold;">except</span> <span style="color: #d2413a; font-weight: bold;">KeyError</span>:
                    <span style="color: #008000; font-weight: bold;">print</span> <span style="color: #ba2121;">&#39;Unknown command&#39;</span>, command[<span style="color: #666666;">0</span>], <span style="color: #ba2121;">&#39;on line &#39;</span>, line_number

                    <span style="color: #408080; font-style: italic;"># Some other error occurred (e.g., the called function raised an Exception)</span>
                    <span style="color: #408080; font-style: italic;"># report it here and continue on (if we didn&#39;t catch it, the program would end)</span>
                <span style="color: #008000; font-weight: bold;">except</span> <span style="color: #d2413a; font-weight: bold;">Exception</span> <span style="color: #008000; font-weight: bold;">as</span> e:
                    <span style="color: #008000; font-weight: bold;">print</span> <span style="color: #ba2121;">&#39;Invalid command&#39;</span>, command[<span style="color: #666666;">0</span>], <span style="color: #ba2121;">&#39;on line &#39;</span>, line_number,  e


<span style="color: #008000; font-weight: bold;">if</span> __name__ <span style="color: #666666;">==</span> <span style="color: #ba2121;">&#39;__main__&#39;</span>:
    <span style="color: #408080; font-style: italic;"># open the first file on the command line, get commands from that and run them</span>
    commands <span style="color: #666666;">=</span> <span style="color: #008000;">open</span>(argv[<span style="color: #666666;">1</span>])<span style="color: #666666;">.</span>xreadlines()

    <span style="color: #408080; font-style: italic;"># note that the parse and draw routine works on a list of commands, it doesn&#39;t know about files</span>
    <span style="color: #408080; font-style: italic;"># or anything else.  This seperation is is useful, as we can get commands from anywhere</span>
    parse_and_draw(commands)
</pre>
</div>

<p>&#0160;</p>

<p>
<a class="asset-img-link" href="http://fivecomputers.typepad.com/.a/6a00e54efca38e8834017c34da956e970b-pi" style="display: inline;"><img alt="12:21:12 10:37 AM" border="0" class="asset  asset-image at-xid-6a00e54efca38e8834017c34da956e970b image-full" src="http://fivecomputers.typepad.com/.a/6a00e54efca38e8834017c34da956e970b-800wi" title="12:21:12 10:37 AM" /></a><br /><br /></p>

                    <div class="clear"></div>
                    <p>There are <a href="http://fivecomputers.com/a-simple-turtle-graphics-domain-specific-language-dsl-parser.html#disqus_thread">comments</a>.</p>
                    <div class="info">
                        <a href="http://fivecomputers.com/a-simple-turtle-graphics-domain-specific-language-dsl-parser.html">posted at 12:00 P</a>&nbsp;&middot;&nbsp;<a href="http://fivecomputers.com/category/21.html" rel="tag">21</a>                                                <div class="tags">
                            <a href="http://fivecomputers.com/tag/books.html">books</a>
                            <a href="http://fivecomputers.com/tag/eda.html">eda</a>
                            <a href="http://fivecomputers.com/tag/verification.html">verification</a>
                        </div>                        
                    </div>
                    <div class="clear"></div>
                </div>

                <h4 class="date">Jun 20,  2008</h4>
                <div class="post">
                    <h2 class="title">
                        <a href="http://fivecomputers.com/a-somewhat-crazy-notion.html" rel="bookmark" title="Permanent Link to &quot;a somewhat crazy notion&quot;">a somewhat crazy notion</a>
                    </h2>
                    
                    <p><a title="Death Valley, after the storm by Gordon McGregor, on Flickr" href="http://www.flickr.com/photos/mcgregorphoto/358741765/"><img height="333" width="500" alt="Death Valley, after the storm" src="http://farm1.static.flickr.com/146/358741765_9ab4eeb321.jpg" /></a>

</p>

<p>Many ideas have been whirling around in my head since being at DAC. I've been inspired to learn some new things, starting with the <a href="http://www.ovmworld.org/">Open Verification Methodology</a> but also revisiting some of the Electronic System Level tools and flows that I've worked with in the past. I'm interested in exploring visualization techniques and tools and how they might be applied to verification and design. I'd also like to learn more about a few of the more interesting formal verification tools, like <a href="http://www.onespin-solutions.com">OneSpin 360 MV</a> and maybe explore what is possible with ESL tools like <a href="http://www.bluespec.com/products/index.htm">Bluespec's SystemVerilog</a> flow or the various other similar tools that are out there.</p>

<p>I have a difficult time learning things just for the sake of it, tending to be more driven by necessity rather than idle curiosity. I've been doing some work based around a small CPU core and started getting frustrated with the way the CPU was architected. This led me to start considering designing my own CPU, just for fun. Partly as a motivation to crack open a Hennessy &amp; Patterson book that I've been meaning to read for a few years, partly to see if I can do it, partly as a vehicle to hang all those other ideas upon.</p>

<p>I've been looking around the web, browsing on <a href="http://opencores.org/">OpenCores</a> and finding humbling projects, such as <a href="http://homebrewcpu.org/">HomebrewCPU,</a> which is a Minix-compatible CPU entirely constructed from discrete gates. You can even browse the web pages that it is serving or telnet in to it! To my way of thinking, that is slightly nuts - impressive, but nuts all the same - five wire-wrapped boards to debug. My <a href="http://www.informatik.uni-trier.de/~ley/db/indices/a-tree/m/McGregor:Gordon.html">background is in FPGAs</a> and that seems the perfect technology for this sort of exploration - I'm also thinking along the way that I might be able to play with synthesisable verification or FPGA enhanced verification/ emulation as well as possibly using this as a platform for a reconfigurable architecture. Lots of ideas, potential and possibilities. It will also give me a chance to re-engage with FPGA technologies and learn about more about the state of those tools. The various tools are getting to a fairly mature point and a simple pipelined CPU shouldn't require too much work but still be complex enough to do interesting things with.</p>

<p>I've been looking at <a href="http://www.xilinx.com">Xilinx</a> and <a href="http://www.altera.com">Altera </a>to get an understanding of their current tool flows and trying to work out language support and maturity - which would be the best option for systemVerilog, where the best simulation options are and that kind of thing. No real conclusions yet, but both have trial versions of what appears to be a complete tool chain, so I will probably drive a small example through both flows as a pipe cleaner.</p>

<p>Then of course there are the more fundamental religious issues - CISC or RISC, what ISA to use. Roll my own, pick up an already defined but open architecture, or something in between? I'm looking for suggestions in this respect - I know ARM are quite litigious when it comes to cloning their ISA, so I'll be avoiding that, but <a href="http://www.opensparc.net/">OpenSPARC</a> might well be a good option. Any other suggestions? I'm not sure if the early MIPS ISAs are cloneable without problems? Maybe I could go really back to my roots and implement a <a href="http://en.wikipedia.org/wiki/Zx81">Z80 architecture</a>. The advantage of picking on an existing ISA is that the tools come mostly for free. While porting gas and gcc to my own ISA could also be an interesting experiment and learning experience, it would probably be more of a distraction than I want.</p>

<p>I am a fan of the Python language and tend to write most of my <a href="http://gordonmcgregor.blogspot.com/2008/03/flickr-set-parser-for-gpsvisualizer.html">personal projects</a> in it. As a result, I'm intrigued by the potential for writing the core in Python, using some of the available extensions and libraries. Two packages seem to already exist, <a href="http://myhdl.jandecaluwe.com/doku.php">MyHDL</a> and <a href="http://pyhvl.sourceforge.net/">PyHVL</a>. MyHDL is Python extension to let you express parallel behaviour that can then be automatically translated to verilog or VHDL. PyHVL provides the other piece of the Python puzzle, enabling high-level verification in Python. So potentially I could do the design and verification in Python then drive through into an FPGA flow for implementation. <a href="http://www.coolverification.com/2008/06/ovm-world-summi.html">JL</a> jokingly mentioned the potential for an OVM port to Python but maybe it isn't such a crazy notion. The thing that Python is fantastic for is expressing complex ideas quickly and without a lot of fuss or housekeeping. From the verification perspective it seems to be a perfect match as I can focus more on the testing, and less on the language. I'm a bit more skeptical about using it on the design side but I think it might be worth a look.</p>

<p>To kick things off, I found the description for a <a href="http://www.csie.ntu.edu.tw/~b92029/data/EXP/mcpu-doc.pdf">minimal CPU</a> on opencores. This is a really basic 8-bit processor, 4 op codes, couple of registers and a very simple, small architecture, yet it can still do some useful function. This evening I wrote a Python ISS for it, just to prove out some ideas. Took about an hour to get a working cycle-based ISS together for the architecture. Of course, immediately the next thing you need is an assembler and that was fairly easy to put together in Python too. Nothing particularly complex, but a two pass assembler that supports labels and constants and generates code that runs on the core. I'm able to assemble and run the example greatest common divisor (Dijkstra's algorithm) described in the paper and it has given me a good indication of the direction to go. So far, my couple of hour project can assemble and execute the following code:</p>

<blockquote><p><span style="font-size: 0.8em;">start:<br />&nbsp; &nbsp; NOR allone&nbsp; &nbsp;&nbsp; &nbsp;; akku == 0<br />&nbsp; &nbsp; NOR b<br />&nbsp; &nbsp; ADD one&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;; akku = -b<br /><br />&nbsp; &nbsp; ADD a&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; ; akku = a - b<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; ; Carry set when akku &gt;= 0<br />&nbsp; &nbsp; JCC neg<br /><br />&nbsp; &nbsp; STA a<br /><br />&nbsp; &nbsp; ADD allone&nbsp; &nbsp;&nbsp; &nbsp;<br />&nbsp; &nbsp; JCC end&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;; A=0 ? -&gt; end, result in b<br /><br />&nbsp; &nbsp; JCC start<br /><br />neg:<br />&nbsp; &nbsp; NOR zero<br />&nbsp; &nbsp; ADD one&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;; Akku = -Akku<br /><br />&nbsp; &nbsp; STA b<br />&nbsp; &nbsp; JCC start&nbsp; &nbsp;&nbsp; &nbsp; ; carry not altered<br /><br />end:<br />&nbsp; &nbsp; JCC end<br /><br />a: 10&nbsp; ; a &amp; b are the two values to consider<br />b: 30<br /><br />allone: 0xff&nbsp; ; various constants<br />zero:&nbsp; &nbsp;0<br />one:&nbsp; &nbsp; 1</span></p></blockquote>

<p>Next step is to describe this trivial core in a synthesisable form and see how I get on running it through one or two FPGA flows. A few tests and some verification could be useful too! For FPGAs I'm much more used to the general <em>suck it and see </em>style of testing that is the norm. Synthesize, place and route and see if it works. In the last several years I've been working on much larger ASICs so have certainly seen the value of more robust verification and I think FPGA technology has probably spent too much time as the wild frontier of design robustness and testing. As this project progresses I want to explore what the best balance is for testing and how the test environments can use the FPGA to accelerate testing along the way.</p>

<p>So plenty of things up in the air but I think this could be fun.</p>

<p><br /></p>

                    <div class="clear"></div>
                    <p>There are <a href="http://fivecomputers.com/a-somewhat-crazy-notion.html#disqus_thread">comments</a>.</p>
                    <div class="info">
                        <a href="http://fivecomputers.com/a-somewhat-crazy-notion.html">posted at 12:00 P</a>&nbsp;&middot;&nbsp;<a href="http://fivecomputers.com/category/20.html" rel="tag">20</a>                                                <div class="tags">
                            <a href="http://fivecomputers.com/tag/cpu.html">cpu</a>
                            <a href="http://fivecomputers.com/tag/dac.html">dac</a>
                            <a href="http://fivecomputers.com/tag/eda.html">eda</a>
                            <a href="http://fivecomputers.com/tag/esl.html">esl</a>
                            <a href="http://fivecomputers.com/tag/software.html">software</a>
                            <a href="http://fivecomputers.com/tag/verification.html">verification</a>
                        </div>                        
                    </div>
                    <div class="clear"></div>
                </div>

                <h4 class="date">Sep  5,  2012</h4>
                <div class="post">
                    <h2 class="title">
                        <a href="http://fivecomputers.com/a-uvm-layer-for-pyhvl.html" rel="bookmark" title="Permanent Link to &quot;A UVM layer for PyHVL&quot;">A UVM layer for PyHVL</a>
                    </h2>
                    
                    <p>Over the past few years I've been building verification environments in Python, hooked up to SystemVerilog and Verilog simulators. The glue is <a href="http://sourceforge.net/projects/pyhvl/">PyHVL</a>. But PyHVL is just the glue. It does open up the possibility of dynamic languages and scripting to talk to your test bench, but it isn't enough to implement a complete verification environment, quickly.</p>

<p>To that end, I've started building analogues for most of the <a href="http://www.uvmworld.org/">UVM</a> classes, in Python/ PyHVL. Monitors, drivers, checkers, interfaces, scoreboards, all the standard sorts of pieces that you'd expect from a modern verification environment. With no compiling between iterations, and a command-line REPL to drop to for debug and interactive exploration. All backed with the batteries-included philosophy of Python. The sweet spot for this is probably somewhere within a fully fleshed out SystemVerilog testbench, leveraging the best features of SV (RTL/design, randomization with constraints, coverage, assertions) with the best features of Python for the higher level pieces of the testbench. At the same time, there is the potential to write the entire testbench in Python and the whole design in Verilog and use a free simulator such as <a href="http://iverilog.icarus.com/">Icarus</a> or <a href="http://sourceforge.net/projects/gplcver/">CVer</a>. Python brings a variety of useful features for testbench development; dynamic language, rapid development, rich set of libraries, fast iteration and a high level programming abstraction.</p>

<p>I've been able to write models of processors that actually execute instructions and check the RTL, where the initial development time for a working CPU model was about 4 hours. There is effectively no recompile time cost - just re-run and the Python verification environment is re-interpreted as the simulation starts up.</p>

<p>The main advantage of using Python for a testbench is writing less code. Less code means fewer bugs. The higher level language features of Python let you write more efficient code. As a quick example, here is the entire class definition for a PyHVL/ UVM interface, ready to hook up to RTL and monitor/drive signals in a DUT.</p>

<div class="highlight" style="background: #f8f8f8">
  <pre style="line-height: 125%">
<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">pluvm.uvm_package</span> <span style="color: #008000; font-weight: bold">import</span> <span style="color: #666666">*</span>

HOST_BUS_SIGNALS<span style="color: #666666">=</span>(<span style="color: #BA2121">'reset'</span>, <span style="color: #BA2121">'clock'</span>, <span style="color: #BA2121">'cycle_count'</span>, <span style="color: #BA2121">'host_rdata'</span>, <span style="color: #BA2121">'host_ack'</span>,
                  <span style="color: #BA2121">'host_err'</span>, <span style="color: #BA2121">'host_address'</span>, <span style="color: #BA2121">'host_valid'</span>, <span style="color: #BA2121">'host_wdata'</span>, 
                  <span style="color: #BA2121">'host_strobe'</span>, <span style="color: #BA2121">'host_rwb'</span>)

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">host_interface</span>(uvm_interface):

        <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__init__</span>(<span style="color: #008000">self</span>, name, hierarchy):
                uvm_interface<span style="color: #666666">.</span>__init__(<span style="color: #008000">self</span>, name, hierarchy)

                <span style="color: #008000; font-weight: bold">for</span> signal <span style="color: #AA22FF; font-weight: bold">in</span> HOST_BUS_SIGNALS:
                        <span style="color: #008000">self</span><span style="color: #666666">.</span>add_signal(signal)

</pre>
</div>

<p>These classes can of course leverage the standard pyunit test frameworks and have unit tests in every class.</p>

                    <div class="clear"></div>
                    <p>There are <a href="http://fivecomputers.com/a-uvm-layer-for-pyhvl.html#disqus_thread">comments</a>.</p>
                    <div class="info">
                        <a href="http://fivecomputers.com/a-uvm-layer-for-pyhvl.html">posted at 12:00 P</a>&nbsp;&middot;&nbsp;<a href="http://fivecomputers.com/category/09.html" rel="tag">09</a>                                                <div class="tags">
                            <a href="http://fivecomputers.com/tag/.html"></a>
                        </div>                        
                    </div>
                    <div class="clear"></div>
                </div>

                <h4 class="date">May 29,  2008</h4>
                <div class="post">
                    <h2 class="title">
                        <a href="http://fivecomputers.com/about-gordon-mcgregor.html" rel="bookmark" title="Permanent Link to &quot;About Gordon McGregor&quot;">About Gordon McGregor</a>
                    </h2>
                    
                    <p>Gordon McGregor is a Verification Consultant at <a href="http://www.verilab.com">Verilab, Inc</a>, based in Austin, Texas.

Prior to that, Gordon worked for <a href="http://www.freescale.com">Freescale Semiconductor</a>, <a href="http://www.motorola.com">Motorola</a> and Pilkington Microelectronics for 7 years through various buy-outs, take-overs and spin-offs, moving from Glasgow, Scotland, to Northwich in England and finally to Austin, Texas.

</p>

<p>He received a Bachelor's degree, Master's degree and PhD from the <a href="http://www.strath.ac.uk">University of Strathclyde</a>, Scotland, in 1993, 1994 and 2005. Mostly these were in electronics, with an end bias towards dynamic reconfiguration of Field Programmable Gate Arrays (FPGAs) and methodology improvements to make dynamic reconfiguration a practical, deployable reality.

</p>

<p>His particular areas of interest are in functional verification techniques and electronic system level design along with the application of the lessons learned in the field of software engineering to the world of hardware design.</p>

                    <div class="clear"></div>
                    <p>There are <a href="http://fivecomputers.com/about-gordon-mcgregor.html#disqus_thread">comments</a>.</p>
                    <div class="info">
                        <a href="http://fivecomputers.com/about-gordon-mcgregor.html">posted at 12:00 P</a>&nbsp;&middot;&nbsp;<a href="http://fivecomputers.com/category/29.html" rel="tag">29</a>                                                <div class="tags">
                            <a href="http://fivecomputers.com/tag/.html"></a>
                        </div>                        
                    </div>
                    <div class="clear"></div>
                </div>

                <h4 class="date">Feb 12,  2008</h4>
                <div class="post">
                    <h2 class="title">
                        <a href="http://fivecomputers.com/complete.html" rel="bookmark" title="Permanent Link to &quot;complete&quot;">complete</a>
                    </h2>
                    
                    <p>Finally! Now my Mac <a href="http://news.bbc.co.uk/2/hi/technology/7760344.stm">can do everything</a> my windows machine can do. I&#39;m so happy.</p>

                    <div class="clear"></div>
                    <p>There are <a href="http://fivecomputers.com/complete.html#disqus_thread">comments</a>.</p>
                    <div class="info">
                        <a href="http://fivecomputers.com/complete.html">posted at 12:00 P</a>&nbsp;&middot;&nbsp;<a href="http://fivecomputers.com/category/02.html" rel="tag">02</a>                                                <div class="tags">
                            <a href="http://fivecomputers.com/tag/software.html">software</a>
                        </div>                        
                    </div>
                    <div class="clear"></div>
                </div>

                <h4 class="date">Aug  4,  2009</h4>
                <div class="post">
                    <h2 class="title">
                        <a href="http://fivecomputers.com/creating-a-codeswarm-movie.html" rel="bookmark" title="Permanent Link to &quot;creating a codeswarm movie&quot;">creating a codeswarm movie</a>
                    </h2>
                    
                    <p style="text-align: center;"><a href="http://www.flickr.com/photos/52043707@N00/3423187687/"><img src="http://farm4.static.flickr.com/3631/3423187687_4a8a94a5bd.jpg" height="375" width="500" alt="code swarm frame" /></a></p>

<p style="text-align: center;"><a href="http://www.mcgregorphoto.com/pub/svipcodeswarm.mpg">Download video (3Mb)</a></p>

<p>A codeswarm is a visualization of the activity within a source code repository. The image and linked video above shows the lifetime of one of <a href="http://www.verilab.com" title="Verilab, Inc.">Verilab's</a> source repositories. You can see code being created, the check-ins as they happen and an indication of which users are doing the work at any given time. It is an example of an <em>'</em><a href="http://www.benfry.com"><em>organic information visualization</em></a>' and is created using the <a href="http://processing.org/">Processing</a> toolkit. The original visualization tools were developed by <a href="http://vis.cs.ucdavis.edu/~ogawa/codeswarm/">Michael Ogawa</a> and the <a href="http://code.google.com/p/codeswarm/">source code is available on Google code</a>.</p>

<p>In this particular case I created the animation on OS X 10.5, using a combination of codeswarm, ffmpeg and LAME. If you are interested in doing something like this yourself:</p>

<p>First you'll need to make sure you have a recent version of the Java Development Kit installed (JDK 1.5 or later). You'll also need a recent version of Ant installed. (I have version 1.7.0, which ships with OS X as default). Download the code_swarm source and install it. Then execute '<em>ant run</em>'. If all is well, you should get a dialog box prompting you for the source repository, user name and password.</p>

<p>At this point, I put in the svn+ssh URL for the Verilab repository that I wanted to visualize. Everything fell over, with a Java error (NoClassDefFoundError within com/trilead/ssh2). From this I realised I needed to install the SSH libraries for <a href="http://www.trilead.com/Products/Trilead_SSH_for_Java/">Java, from Trilead</a>. I downloaded those, unpacked them and added the <em>jar</em> file to my CLASSPATH. Along the way I found out the default OS X CLASSPATH definition is in <em>/System/Library/Java/JavaConfig.plist</em> which may be useful as a starting point.</p>

<p>With that fixed, I again ran '<em>ant run</em>' and put in the relevant information. A bit of time passes as the checkin information is extracted from the repository, then the visualisation runs. You'll find that repository information that was extracted is saved, under the ./data directory (look for the latest realtime_sample.*.xml file) . This is useful for the next stages, as you don't have to fetch the information again. If you want to create a video of the visualisation, there are a few more hoops to jump through.</p>

<p>You will need to configure codeswarm to save the frames for each stage of the visualisation. You do this by editing the <em>./data/sample.config</em> file. First off, copy it to a new version for your particular project. Then edit these values:</p>

<ul>
  <li>InputFile= [Point it at the new realtime_sample&lt;number&gt;.xml file in the data directory, that contains the checkin information for your project]</li>

  <li>TakeSnapshots=true</li>
</ul>

<p>That's all you really need to change. You can also change the other values, to alter the visualisation. The ColorAssignX= statements use regexp values to differentiate different types of checkin and colour code them accordingly. Play around with the other values, with TakeSnapshots set to false and re-run the visualisation until you get something you are satisfied with. Then run one more time with TakeSnapshots=true to save off the frame images. You can run with the new configuration by running '<em>ant run data/your_project.config'</em><br /></p>

<p>After running with TakeSnapshots enabled, you'll have a set of images in the ./frames directory, (controlled by the SnapshotLocation option in the config file). The final step is to assemble those into a movie. The easiest way I found to do this is to use the command-line utility, ffmpeg. There are a variety of ways to install ffmpeg, but the simplest way seems to be to install <a href="http://homepage.mac.com/major4/">ffmpegX</a> and <a href="http://www.macosxhints.com/article.php?story=20061220082125312">then extract the binary</a> from the application bundle. You can also get it using <a href="http://www.finkproject.org/">Fink</a> or <a href="http://www.macports.org/">MacPorts</a>. If you want to use an audio track with your visualisation, you will also probably require <a href="http://lame.sourceforge.net">LAME</a>. With ffmpeg working, it is simple to point it towards the image files from codeswarm and produce the final movie. The finishing touch was adding some music from an mp3 file, then limiting the duration via the -t switch, to end when the video frames ran out, rather than playing all of the music.</p>

<p>ffmpeg -i frames/code_swarm-%05d.png -i 6_sym.mp3 -qmax 15 -t 100 -f image2 -r 24 &lt;output_filename&gt;.mpg</p>

<p>You can run 'ffmpeg' without any switches to get help on the options. If all goes well, you should end up with an MPEG format video in the file &lt;output_filename&gt;.mpg.</p>

<div class="posttagsblock"><a href="http://technorati.com/tag/OSX" rel="tag">OSX</a>, <a href="http://technorati.com/tag/visualisation" rel="tag">visualisation</a></div>

                    <div class="clear"></div>
                    <p>There are <a href="http://fivecomputers.com/creating-a-codeswarm-movie.html#disqus_thread">comments</a>.</p>
                    <div class="info">
                        <a href="http://fivecomputers.com/creating-a-codeswarm-movie.html">posted at 12:00 P</a>&nbsp;&middot;&nbsp;<a href="http://fivecomputers.com/category/08.html" rel="tag">08</a>                                                <div class="tags">
                            <a href="http://fivecomputers.com/tag/software.html">software</a>
                            <a href="http://fivecomputers.com/tag/verification.html">verification</a>
                        </div>                        
                    </div>
                    <div class="clear"></div>
                </div>

                <h4 class="date">Jan 23,  2011</h4>
                <div class="post">
                    <h2 class="title">
                        <a href="http://fivecomputers.com/csv-the-easy-way.html" rel="bookmark" title="Permanent Link to &quot;csv the easy way&quot;">csv the easy way</a>
                    </h2>
                    
                    <p>I've recently started using <a href="http://fogcreek.com/">FogCreek's</a> <a href="http://www.fogcreek.com/FogBugz/">FogBugz</a> project hosting for a small personal project. It has a built-in Mercurial source repository, with some enhancements, called Kiln, and good task/ project tracking features. Quite similar to those you find in <a href="http://trac.edgewall.org/">Trac</a>. Rather than putting together the various servers to track my own project, I figured I might as well use what they give away for free, for small project teams. I had a list of tasks that I wanted to import into the FogBugz task list, from a CSV file. In fact, this was a CSV file I'd exported from a different FogBugz site, but it could well have been any list of comma seperated values holding task information. The trick was how to get that information from my computer onto the FogBugz site. They didn't have any obvious CSV import option, but they do publish an XML API. Luckily enough, there is also a set of <a href="https://our.fogbugz.com/default.asp?W1048">python bindings around the API</a>. Amazingly enough, I was able to open and read the CSV file, parse it, login in to my FogBugz account and upload the new tasks to the server with just this little snippet of code.</p>

<p><br />
<div class="highlight">
  <pre>
<span class="kn">from</span> <span class="nn">fogbugz</span> <span class="kn">import</span> <span class="n">FogBugz</span>
<span class="kn">import</span> <span class="nn">csv</span>
<span class="n">fb</span> <span class="o">=</span> <span class="n">FogBugz</span><span class="p">(</span><span class="s">'http://my_site.fogbugz.com/'</span><span class="p">)</span> <span class="c"># URL is to your FogBugz install</span>
<span class="n">fb</span><span class="o">.</span><span class="n">logon</span><span class="p">(</span><span class="s">'my_login@my.site.com'</span><span class="p">,</span> <span class="s">'password'</span><span class="p">)</span></p>
<p><span class="n">cases</span><span class="o">=</span><span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s">'Filter.csv'</span><span class="p">,</span><span class="s">'r'</span><span class="p">))</span>
<span class="k">for</span> <span class="n">case</span> <span class="ow">in</span> <span class="n">cases</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">case</span>
    <span class="n">fb</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">sCategory</span><span class="o">=</span><span class="n">case</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sTitle</span><span class="o">=</span><span class="n">case</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">sPriority</span><span class="o">=</span><span class="n">case</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span> </p>
<p><span class="n">fb</span><span class="o">.</span><span class="n">logoff</span><span class="p">()</span>
</pre>
</div>Pretty cool if you ask me! Quick and dirty, throwaway code, but so powerful for so few lines.<br />
<br /></p>

                    <div class="clear"></div>
                    <p>There are <a href="http://fivecomputers.com/csv-the-easy-way.html#disqus_thread">comments</a>.</p>
                    <div class="info">
                        <a href="http://fivecomputers.com/csv-the-easy-way.html">posted at 12:00 P</a>&nbsp;&middot;&nbsp;<a href="http://fivecomputers.com/category/23.html" rel="tag">23</a>                                                <div class="tags">
                            <a href="http://fivecomputers.com/tag/software.html">software</a>
                        </div>                        
                    </div>
                    <div class="clear"></div>
                </div>

                <div class="clear"></div>
                <div class="pages">
                    <a href="http://fivecomputers.com/author/gordonmcgregor2.html" class="next_page">Next&nbsp;&rarr;</a>
                    <span>Page 1 of 5</span>
                </div>

                <div class="clear"></div>
                <div id="footer">
                    <p>
                    <a href="https://twitter.com/GordonMcGregor">Twitter @GordonMcGregor</a>
                    &middot;
                    <a class="atom" href="http://fivecomputers.com/feeds/all.atom.xml">RSS Feed</a>
                </div>
            </div>
            <div class="clear"></div>
        </div>
    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
        var pageTracker = _gat._getTracker("UA-42678190-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>
<script type="text/javascript">
    var disqus_shortname = 'fivecomputers';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
    </body>
</html>